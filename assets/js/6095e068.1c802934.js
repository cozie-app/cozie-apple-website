"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[326],{9548:(t,e,l)=>{l.r(e),l.d(e,{assets:()=>a,contentTitle:()=>r,default:()=>o,frontMatter:()=>d,metadata:()=>x,toc:()=>c});var s=l(4848),n=l(8453),i=l(6025);const d={id:"backend_database_to_cozie",title:"Reading Cozie data",sidebar_label:"Reading Cozie data"},r=void 0,x={id:"backend/backend_database_to_cozie",title:"Reading Cozie data",description:"Overview",source:"@site/docs/8_backend/03_database_to_cozie.md",sourceDirName:"8_backend",slug:"/backend/backend_database_to_cozie",permalink:"/docs/backend/backend_database_to_cozie",draft:!1,unlisted:!1,editUrl:"https://github.com/cozie-app/cozie-apple-website/tree/master/docs/8_backend/03_database_to_cozie.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"backend_database_to_cozie",title:"Reading Cozie data",sidebar_label:"Reading Cozie data"},sidebar:"myAutogeneratedSidebar",previous:{title:"Sending Cozie data",permalink:"/docs/backend/backend_cozie_to_database"},next:{title:"Retrieving data",permalink:"/docs/backend/backend_retrieving_cozie_data"}},a={},c=[{value:"Overview",id:"overview",level:2},{value:"Changes in the Cozie app",id:"changes-in-the-cozie-app",level:2},{value:"Lambda function code",id:"lambda-function-code",level:3},{value:"Lambda configuration",id:"lambda-configuration",level:3},{value:"API Gateway configuration",id:"api-gateway-configuration",level:3}];function h(t){const e={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{alt:"Data flow from database to Cozie",src:(0,i.A)("img/backend/backend_read_influx.jpg"),width:"30%"}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"The information shown in the 'Watch Survey' section on the 'Data' tab of the Cozie app is fetched from InfluxDB using the read API. These fields are a way for the participant to receive immediate feedback about the validity of their responses."}),"\n",(0,s.jsx)("img",{alt:"Watch Survey section in Data tab",src:(0,i.A)("img/backend/cozie_tab_data_section_watch_survey.png"),width:"30%"}),"\n",(0,s.jsx)(e.p,{children:"In the example above the, '100' is retrieved from the 'Settings' tab. The other three fields are retrieved using the read API."}),"\n",(0,s.jsx)(e.p,{children:"The response body of the read API looks as follows:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:'title="Read API response body"',children:'{\n   "ws_survey_count_valid":"0",\n   "ws_survey_count_invalid":"0",\n   "ws_timestamp_survey_last":"-"\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"changes-in-the-cozie-app",children:"Changes in the Cozie app"}),"\n",(0,s.jsxs)(e.p,{children:["In order to have Cozie app read the data from your own backend, you need to update ",(0,s.jsx)(e.code,{children:"API Read URL"})," and the ",(0,s.jsx)(e.code,{children:"API Read Key"})," in the 'Backend' tab of the Cozie app."]}),"\n",(0,s.jsx)(e.h3,{id:"lambda-function-code",children:"Lambda function code"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/cozie-app/cozie-apple-backend/tree/main/lambda_cozie-apple-v3-app-read-influx-cozie",children:"cozie-apple-v3-app-read-influx-cozie"})}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"lambda-configuration",children:"Lambda configuration"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Configuration"}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Value"}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Comment"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"General configuration"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Memory"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"512 MB"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Ephemeral storage"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"512 MB"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default value"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Timeout"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"0 min 30 sec"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Triggers"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"API Gateway"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"cozie-apple-v3-researcher-api"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Environment variables"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"DB_HOST"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"XXX.influxcloud.net"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"(replace 'XXX')"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"DB_NAME"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"cozie-apple"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"DB_PASSWORD"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"XXX"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"(replace 'XXX')"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"DB_PORT"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"8086"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"DB_USER"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Cozie-Apple-Lambda-Reader-App-API"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Layers"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"AWSSDKPandas-Python311"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"AWS Layer for Pandas"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Influx"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Custom layer for InfluxDB client"})]})]})]}),"\n",(0,s.jsx)(e.h3,{id:"api-gateway-configuration",children:"API Gateway configuration"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Configuration"}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Value"}),(0,s.jsx)(e.th,{style:{textAlign:"left"},children:"Comment"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Proxy resource"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"disabled"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Resource path"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"/"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Resource name"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"read-queue"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"CORS (Cross Origin Resource Sharing)"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"enabled"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Method details"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Method type"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"ANY"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Integration type"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Lambda function"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Lambda proxy integration"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"enabled"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Lambda function"}),(0,s.jsxs)(e.td,{style:{textAlign:"left"},children:["arn:aws:lambda:[region]:[Accound ID]:function",":cozie-apple-v3-app-read"]}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"check dropdown menu"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Default timeout"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"enabled"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"29 seconds (default)"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Method request settings"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Authorization"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"None"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"Request validator"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"None"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"API key required"}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"enabled"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"URL query string parameters"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"leave empty"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"HTTP request headers"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"leave empty"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:(0,s.jsx)(e.strong,{children:"Request body"})}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"}})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"leave empty"}),(0,s.jsx)(e.td,{style:{textAlign:"left"}}),(0,s.jsx)(e.td,{style:{textAlign:"left"},children:"default"})]})]})]})]})}function o(t={}){const{wrapper:e}={...(0,n.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(h,{...t})}):h(t)}},8453:(t,e,l)=>{l.d(e,{R:()=>d,x:()=>r});var s=l(6540);const n={},i=s.createContext(n);function d(t){const e=s.useContext(i);return s.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function r(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(n):t.components||n:d(t.components),s.createElement(i.Provider,{value:e},t.children)}}}]);